<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/Volumes/Crucial X6/EPSI_I1/atelier-auto-tests/automatisation-test/PomodoroApp/Components/Pages/Counter.razor</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
@page &quot;/counter&quot;
@rendermode InteractiveServer
@using System.Timers
@using System.IO;
@using System.Text.Json;
@using System.Collections.Generic;
@using System.Diagnostics;


&lt;PageTitle&gt;Counter&lt;/PageTitle&gt;

&lt;h1&gt;Counter&lt;/h1&gt;

&lt;button class=&quot;btn btn-primary&quot; @onclick=&quot;Set25&quot; disabled=&quot;@is25&quot;&gt;25/5&lt;/button&gt;
&lt;button class=&quot;btn btn-primary&quot; @onclick=&quot;Set45&quot; disabled=&quot;@(!is25)&quot;&gt;45/15&lt;/button&gt;

&lt;p role=&quot;status&quot;&gt;@typeTime: @formatTime(remainingTime)&lt;/p&gt;

&lt;button class=&quot;btn btn-primary&quot; @onclick=&quot;StartTimer&quot; disabled=&quot;@isTimerRunning&quot;&gt;Start&lt;/button&gt;
&lt;button class=&quot;btn btn-primary&quot; @onclick=&quot;PauseTimer&quot; disabled=&quot;@(!isTimerRunning)&quot;&gt;Pause&lt;/button&gt;
&lt;button class=&quot;btn btn-primary&quot; @onclick=&quot;ResetTimer&quot; disabled=&quot;@(!isTimerPaused)&quot;&gt;Reset&lt;/button&gt;
&lt;button class=&quot;btn btn-primary&quot; @onclick=&quot;endSession&quot; disabled=&quot;@(!isTimerPaused)&quot;&gt;End&lt;/button&gt;



@code {
public class MyData
{
public string startTime { get; set; }
public string endTime { get; set; }
public string status { get; set; }
public string pauseTime { get; set; }
public string workTime { get; set; }
public string totalTime { get; set; }
}
public int currentCount = 0;
public int pomodoroDuration = 1 * 60; // 25 minutes in seconds
public int remainingTime;
public bool isTimerRunning = false;
public bool isTimerPaused = false;
public bool is25 = true;
public Timer timer;
public string typeTime = &quot;Travail&quot;;
public Stopwatch dureeTravail = new Stopwatch();
public Stopwatch dureePause = new Stopwatch();
public Stopwatch dureeTotale = new Stopwatch();
public DateTime dateDebut;


protected override void OnInitialized()
{
remainingTime = pomodoroDuration;
timer = new Timer(1000);
timer.Elapsed += TimerElapsed;
}

public void TimerElapsed(object sender, ElapsedEventArgs e)
{
remainingTime--;

if (remainingTime &lt;= 0)
{
timer.Stop();
isTimerRunning = false;

if (typeTime == &quot;Pause&quot;)
{
typeTime = &quot;Travail&quot;;
if (is25 == true)
{
pomodoroDuration = 25 * 60;
remainingTime = pomodoroDuration;
dureeTravail.Start();
dureePause.Stop();
StartTimer();
}
else
{
pomodoroDuration = 45 * 60;
remainingTime = pomodoroDuration;
dureeTravail.Start();
dureePause.Stop();
StartTimer();
}
} else if (typeTime == &quot;Travail&quot;)
{
typeTime = &quot;Pause&quot;;
if (is25 == true)
{
pomodoroDuration = 1 * 60;
remainingTime = pomodoroDuration;
dureePause.Start();
dureeTravail.Stop();
StartTimer();
}
else
{
pomodoroDuration = 15 * 60;
remainingTime = pomodoroDuration;
dureePause.Start();
dureeTravail.Stop();
StartTimer();
}
}


}

InvokeAsync(StateHasChanged);
}

public void IncrementCount()
{
currentCount++;
}

public void StartTimer()
{
isTimerRunning = true;
isTimerPaused = false;
if (currentCount == 0)
{
dureeTotale.Start();
dureeTravail.Start();
dateDebut = DateTime.Now;
}
currentCount++;
timer.Start();
}

public void PauseTimer()
{
isTimerPaused = true;
isTimerRunning = false;
timer.Stop();
dureeTotale.Stop();
dureeTravail.Stop();
dureePause.Stop();
}

public void ResetTimer()
{
timer.Stop();
remainingTime = pomodoroDuration;
}

public string formatTime(int seconds)
{
int minutes = seconds / 60;
int secs = seconds % 60;
return $&quot;{minutes:00}:{secs:00}&quot;;
}

public void Set25()
{
is25 = true;
pomodoroDuration = 25 * 60;
remainingTime = pomodoroDuration;
}

public void Set45()
{
is25 = false;
pomodoroDuration = 45 * 60;
remainingTime = pomodoroDuration;
}

public async void endSession()
{
DateTime dateFin = DateTime.Now;
dureeTotale.Stop();
dureePause.Stop();
dureeTravail.Stop();
string typePomodoro = &quot;&quot;;
if (is25)
{
typePomodoro = &quot;25/5&quot;;
}
else
{
typePomodoro = &quot;45/15&quot;;
}


MyData myData = new MyData
{
startTime = dateDebut.ToString(),
endTime = dateFin.ToString(),
status = typePomodoro,
pauseTime = dureePause.Elapsed.ToString(),
workTime = dureeTravail.Elapsed.ToString(),
totalTime = dureeTotale.Elapsed.ToString(),
};
string readJsonData = await File.ReadAllTextAsync(&quot;wwwroot/data/sequences.json&quot;);
List&lt;MyData&gt; dataList = JsonSerializer.Deserialize&lt;List&lt;MyData&gt;&gt;(readJsonData) ?? new List&lt;MyData&gt;();
dataList.Add(myData);
string jsonData = JsonSerializer.Serialize(dataList);
await File.WriteAllTextAsync(&quot;wwwroot/data/sequences.json&quot;, jsonData);
}

}
    </pre>
    <script type="text/javascript">
      highlightRanges([[29,27,29,31,0],[29,32,29,36,1],[30,25,30,29,0],[30,30,30,34,1],[31,24,31,28,0],[31,29,31,33,1],[32,27,32,31,0],[32,32,32,36,1],[33,26,33,30,0],[33,31,33,35,1],[34,27,34,31,0],[34,32,34,36,1],[36,1,36,29,1],[37,1,37,38,1],[39,1,39,36,1],[40,1,40,35,1],[41,1,41,25,1],[43,1,43,36,1],[44,1,44,49,1],[45,1,45,47,1],[46,1,46,48,1],[51,1,51,2,0],[52,1,52,34,0],[53,1,53,25,0],[54,1,54,31,0],[55,1,55,2,0],[58,1,58,2,0],[59,1,59,17,0],[61,1,61,24,0],[62,1,62,2,0],[63,1,63,14,0],[64,1,64,24,0],[66,1,66,25,0],[67,1,67,2,0],[68,1,68,22,0],[69,1,69,18,0],[70,1,70,2,0],[71,1,71,28,0],[72,1,72,34,0],[73,1,73,22,0],[74,1,74,19,0],[75,1,75,14,0],[76,1,76,2,0],[78,1,78,2,0],[79,1,79,28,0],[80,1,80,34,0],[81,1,81,22,0],[82,1,82,19,0],[83,1,83,14,0],[84,1,84,2,0],[85,1,85,2,0],[85,8,85,34,0],[86,1,86,2,0],[87,1,87,20,0],[88,1,88,18,0],[89,1,89,2,0],[90,1,90,27,0],[91,1,91,34,0],[92,1,92,20,0],[93,1,93,21,0],[94,1,94,14,0],[95,1,95,2,0],[97,1,97,2,0],[98,1,98,28,0],[99,1,99,34,0],[100,1,100,20,0],[101,1,101,21,0],[102,1,102,14,0],[103,1,103,2,0],[104,1,104,2,0],[107,1,107,2,0],[109,1,109,30,0],[110,1,110,2,0],[113,1,113,2,1],[114,1,114,16,1],[115,1,115,2,1],[118,1,118,2,1],[119,1,119,23,1],[120,1,120,23,1],[121,1,121,23,1],[122,1,122,2,1],[123,1,123,21,1],[124,1,124,22,1],[125,1,125,26,1],[126,1,126,2,1],[127,1,127,16,1],[128,1,128,15,1],[129,1,129,2,1],[132,1,132,2,1],[133,1,133,22,1],[134,1,134,24,1],[135,1,135,14,1],[136,1,136,20,1],[137,1,137,21,1],[138,1,138,19,1],[139,1,139,2,1],[142,1,142,2,1],[143,1,143,14,1],[144,1,144,34,1],[145,1,145,2,1],[148,1,148,2,1],[149,1,149,28,1],[150,1,150,25,1],[151,1,151,34,1],[152,1,152,2,1],[155,1,155,2,1],[156,1,156,13,1],[157,1,157,28,1],[158,1,158,34,1],[159,1,159,2,1],[162,1,162,2,1],[163,1,163,14,1],[164,1,164,28,1],[165,1,165,34,1],[166,1,166,2,1],[169,1,169,2,1],[170,1,170,33,1],[171,1,171,20,1],[172,1,172,19,1],[173,1,173,21,1],[174,1,174,26,1],[175,1,175,10,1],[176,1,176,2,1],[177,1,177,23,1],[178,1,178,2,1],[180,1,180,2,0],[181,1,181,24,0],[182,1,182,2,0],[185,1,193,3,1],[194,1,194,82,1],[195,1,195,102,1],[196,1,196,22,0],[197,1,197,54,0],[198,1,198,71,0],[199,1,199,2,0]]);
    </script>
  </body>
</html>